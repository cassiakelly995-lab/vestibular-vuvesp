<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNESP Study Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs, deleteDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD_QLNBMIYh_6SnTYfjjG0N4eDxfRwPuEE",
    authDomain: "painel-da-cassia-concurso.firebaseapp.com",
    projectId: "painel-da-cassia-concurso",
    storageBucket: "painel-da-cassia-concurso.firebasestorage.app",
    messagingSenderId: "88462134882",
    appId: "1:88462134882:web:946223397c13ca8519cb3b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ‚îÄ‚îÄ ID FIXO ‚Äî s√≥ voc√™ usa ‚îÄ‚îÄ
  const currentUID = "meu_estudo";
  window._uid = currentUID;
  document.getElementById("uid-badge").textContent = "‚òÅÔ∏è Firebase conectado";
  loadAllFromFirebase();

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  FUN√á√ïES FIREBASE ‚Äî expostas globalmente
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  // ‚îÄ‚îÄ SALVAR PROGRESSO (studied + quizScores) ‚îÄ‚îÄ
  window.fbSaveProgress = async function() {
    if (!currentUID) return;
    try {
      await setDoc(doc(db, "usuarios", currentUID, "dados", "progresso"), {
        studied: window.studied || {},
        quizOk: window.qOk || 0,
        quizErr: window.qErr || 0,
        updatedAt: serverTimestamp()
      });
    } catch(e) { console.error("Erro ao salvar progresso:", e); }
  };

  // ‚îÄ‚îÄ SALVAR REDA√á√ÉO ‚îÄ‚îÄ
  window.fbSaveEssay = async function(titulo, tema, tipo, texto, scores, feedback) {
    if (!currentUID) return null;
    try {
      const id = "essay_" + Date.now();
      await setDoc(doc(db, "usuarios", currentUID, "redacoes", id), {
        id, titulo, tema, tipo, texto,
        c1: scores?.c1 || 0, c2: scores?.c2 || 0,
        c3: scores?.c3 || 0, c4: scores?.c4 || 0,
        c5: scores?.c5 || 0, total: scores?.total || 0,
        feedback: feedback || "",
        savedAt: serverTimestamp()
      });
      return id;
    } catch(e) { console.error("Erro ao salvar reda√ß√£o:", e); return null; }
  };

  // ‚îÄ‚îÄ BUSCAR REDA√á√ïES SALVAS ‚îÄ‚îÄ
  window.fbGetEssays = async function() {
    if (!currentUID) return [];
    try {
      const q = query(collection(db, "usuarios", currentUID, "redacoes"), orderBy("savedAt", "desc"));
      const snap = await getDocs(q);
      return snap.docs.map(d => d.data());
    } catch(e) {
      // fallback sem orderBy se √≠ndice n√£o existir
      try {
        const snap = await getDocs(collection(db, "usuarios", currentUID, "redacoes"));
        return snap.docs.map(d => d.data()).sort((a,b) => (b.savedAt?.seconds||0) - (a.savedAt?.seconds||0));
      } catch(e2) { console.error(e2); return []; }
    }
  };

  // ‚îÄ‚îÄ DELETAR REDA√á√ÉO ‚îÄ‚îÄ
  window.fbDeleteEssay = async function(id) {
    if (!currentUID) return;
    try {
      await deleteDoc(doc(db, "usuarios", currentUID, "redacoes", id));
    } catch(e) { console.error("Erro ao deletar:", e); }
  };

  // ‚îÄ‚îÄ CARREGAR TUDO ‚îÄ‚îÄ
  async function loadAllFromFirebase() {
    try {
      const snap = await getDoc(doc(db, "usuarios", currentUID, "dados", "progresso"));
      if (snap.exists()) {
        const data = snap.data();
        window.studied = data.studied || {};
        window.qOk = data.quizOk || 0;
        window.qErr = data.quizErr || 0;
        if (typeof window.render === "function") window.render();
        if (typeof window.renderFilters === "function") window.renderFilters();
      }
      setStatus("‚úÖ Dados carregados do Firebase");
    } catch(e) {
      console.error("Erro ao carregar:", e);
      setStatus("‚ö†Ô∏è Modo offline ‚Äî dados locais");
    }
  }

  function setStatus(msg) {
    const el = document.getElementById("fb-status");
    if (el) { el.textContent = msg; setTimeout(() => el.textContent = "", 3000); }
  }
  window._setStatus = setStatus;
</script>

<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BASE TOKENS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root{
  --ink:#0c0c14;--ink2:#11111f;--ink3:#181828;--ink4:#20203a;
  --line:#ffffff0f;--line2:#ffffff18;--line3:#ffffff28;
  --txt:#e8e3ff;--sub:#8888b8;--dim:#44445a;
  --v:#7c5cfc;--v2:#a07cfc;--v3:#5238c8;
  --go:#f0b429;--go2:#ffe082;
  --ok:#22c55e;--no:#f43f5e;--cy:#06b6d4;--pi:#ec4899;--or:#fb923c;
  --r:14px;--r2:10px;--r3:20px;
  --sh:0 4px 24px #0000004a;--sh2:0 12px 48px #00000066;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-font-smoothing:antialiased}
html{scroll-behavior:smooth}
body{font-family:'Syne',sans-serif;background:var(--ink);color:var(--txt);min-height:100vh;overflow-x:hidden;}
body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:radial-gradient(ellipse 80% 50% at 10% 0%,rgba(124,92,252,.12) 0%,transparent 55%),
    radial-gradient(ellipse 60% 40% at 90% 100%,rgba(240,180,41,.08) 0%,transparent 55%),
    radial-gradient(ellipse 40% 30% at 50% 50%,rgba(6,182,212,.05) 0%,transparent 60%);}
body::after{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.018;
  background-image:repeating-linear-gradient(0deg,#fff 0px,#fff 1px,transparent 1px,transparent 60px),
    repeating-linear-gradient(90deg,#fff 0px,#fff 1px,transparent 1px,transparent 60px);}

/* HEADER */
.hdr{position:sticky;top:0;z-index:300;background:rgba(12,12,20,.88);backdrop-filter:blur(28px) saturate(140%);border-bottom:1px solid var(--line);}
.hdr-in{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:0 28px;height:62px;gap:16px;}
.brand{display:flex;align-items:center;gap:11px}
.brand-mark{width:36px;height:36px;border-radius:10px;flex-shrink:0;background:linear-gradient(135deg,var(--v),var(--v2));display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 4px 14px rgba(124,92,252,.4);}
.brand-name{font-family:'Instrument Serif',serif;font-size:20px;color:var(--txt);line-height:1.1;}
.brand-sub{font-size:10px;color:var(--sub);font-family:'DM Mono',monospace;margin-top:1px}
.hdr-pills{display:flex;gap:6px;flex-wrap:wrap;align-items:center;}
.pill{background:var(--ink3);border:1px solid var(--line2);border-radius:30px;padding:4px 12px;font-size:11px;color:var(--sub);font-family:'DM Mono',monospace;white-space:nowrap;}
.pill b{color:var(--v2)}
.fb-badge{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.25);border-radius:20px;padding:3px 10px;font-size:10px;color:var(--ok);font-family:'DM Mono',monospace;white-space:nowrap;}
.fb-status{font-size:10px;color:var(--sub);font-family:'DM Mono',monospace;min-width:180px;text-align:right;}

/* NAV */
.nav{position:sticky;top:62px;z-index:200;background:rgba(17,17,31,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--line);overflow-x:auto;}
.nav::-webkit-scrollbar{display:none}
.nav-in{max-width:1400px;margin:0 auto;display:flex;padding:0 28px}
.nb{background:none;border:none;border-bottom:2px solid transparent;color:var(--sub);padding:14px 18px;cursor:pointer;font-size:12px;font-family:'Syne',sans-serif;font-weight:700;white-space:nowrap;transition:all .2s;letter-spacing:.3px;display:flex;align-items:center;gap:7px;text-transform:uppercase;}
.nb:hover{color:var(--txt)}.nb.on{color:var(--v2);border-bottom-color:var(--v)}

/* LAYOUT */
.main{max-width:1400px;margin:0 auto;padding:28px 28px 60px}
.tab{display:none}.tab.active{display:block;animation:fadeUp .3s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* FILTROS */
.fbar{display:flex;gap:7px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
.flabel{font-size:10px;color:var(--dim);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:.6px;margin-right:4px}
.fc{background:var(--ink3);border:1px solid var(--line2);border-radius:30px;padding:4px 13px;cursor:pointer;font-size:12px;font-weight:700;font-family:'Syne',sans-serif;transition:all .2s;color:var(--sub);letter-spacing:.2px;}
.fc:hover{border-color:var(--line3);color:var(--txt)}.fc.on{color:#fff}
.dbar{display:flex;gap:5px}
.dc{background:var(--ink3);border:1px solid var(--line2);border-radius:8px;padding:5px 13px;cursor:pointer;font-size:11px;font-weight:700;font-family:'DM Mono',monospace;transition:all .2s;color:var(--sub);}
.dc.on[data-d="0"]{background:var(--ink4);border-color:var(--line3);color:var(--txt)}
.dc.on[data-d="1"]{background:rgba(34,197,94,.12);border-color:var(--ok);color:var(--ok)}
.dc.on[data-d="2"]{background:rgba(240,180,41,.12);border-color:var(--go);color:var(--go)}
.dc.on[data-d="3"]{background:rgba(244,63,94,.12);border-color:var(--no);color:var(--no)}

/* SE√á√ÉO */
.sec-hd{margin-bottom:22px}
.sec-title{font-family:'Instrument Serif',serif;font-size:26px;color:var(--txt);line-height:1.2;margin-bottom:4px;}
.sec-sub{font-size:12px;color:var(--sub);line-height:1.6}

/* PROGRESS */
.prog-strip{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);padding:14px 20px;display:flex;gap:20px;flex-wrap:wrap;align-items:center;margin-bottom:20px;}
.ps-item{display:flex;flex-direction:column;gap:2px}
.ps-label{font-size:10px;color:var(--dim);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:.5px}
.ps-val{font-size:22px;font-weight:800;font-family:'DM Mono',monospace}
.ps-bar-wrap{flex:1;min-width:200px}
.ps-bar{height:5px;background:var(--line2);border-radius:3px;overflow:hidden;margin-top:5px}
.ps-fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.4,0,.2,1)}

/* FLASHCARDS */
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:13px}
.card{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);padding:18px;cursor:pointer;transition:transform .25s,border-color .25s,box-shadow .25s;min-height:130px;position:relative;overflow:hidden;}
.card::before{content:"";position:absolute;inset:0;opacity:0;background:linear-gradient(135deg,rgba(124,92,252,.09),transparent 70%);transition:opacity .3s;pointer-events:none;}
.card:hover{transform:translateY(-3px);border-color:var(--line2);box-shadow:var(--sh)}
.card:hover::before,.card.flip::before{opacity:1}
.card.flip{border-color:rgba(124,92,252,.4);box-shadow:0 8px 32px rgba(124,92,252,.14)}
.card-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;gap:6px}
.stag{border-radius:7px;padding:3px 9px;font-size:10px;font-weight:700;letter-spacing:.3px}
.dtag{border-radius:6px;padding:2px 8px;font-size:10px;font-weight:700;font-family:'DM Mono',monospace}
.d1{background:rgba(34,197,94,.12);color:var(--ok)}.d2{background:rgba(240,180,41,.12);color:var(--go)}.d3{background:rgba(244,63,94,.12);color:var(--no)}
.card-q{font-size:13px;line-height:1.6;color:var(--txt);font-weight:600;margin-bottom:6px}
.card-hint{font-size:11px;color:var(--dim);font-style:italic;display:flex;align-items:center;gap:5px}
.card-ans{display:none;border-top:1px solid var(--line);padding-top:10px;margin-top:8px;font-size:13px;line-height:1.7;color:#c0b8e0;}
.card.flip .card-ans{display:block}.card.flip .card-hint{display:none}
.card-check{position:absolute;top:11px;right:11px;width:20px;height:20px;border-radius:50%;background:rgba(34,197,94,.2);border:1px solid var(--ok);display:flex;align-items:center;justify-content:center;font-size:11px}
.empty{text-align:center;padding:60px 20px;color:var(--dim);font-size:14px}

/* QUIZ */
.quiz-wrap{max-width:720px;margin:0 auto}
.quiz-hdr{display:flex;align-items:center;gap:14px;margin-bottom:20px}
.qprog{flex:1;height:4px;background:var(--line2);border-radius:2px;overflow:hidden}
.qprog-fill{height:100%;background:linear-gradient(90deg,var(--v),var(--v2));border-radius:2px;transition:width .4s}
.qmeta{display:flex;gap:14px;font-size:12px;font-family:'DM Mono',monospace;white-space:nowrap}
.q-ok{color:var(--ok)}.q-no{color:var(--no)}
.qbox{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);padding:28px;margin-bottom:14px;}
.qbox-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px}
.qsrc{font-size:10px;color:var(--dim);font-family:'DM Mono',monospace}
.qq{font-size:16px;line-height:1.7;color:var(--txt);font-weight:600}
.opts{display:flex;flex-direction:column;gap:9px}
.opt{background:var(--ink2);border:1px solid var(--line);color:var(--txt);border-radius:var(--r2);padding:13px 17px;text-align:left;cursor:pointer;font-family:'Syne',sans-serif;font-size:13px;line-height:1.45;transition:all .2s;font-weight:500;}
.opt:hover:not(:disabled){border-color:var(--v);background:rgba(124,92,252,.1)}
.opt.ok{background:rgba(34,197,94,.1);border-color:var(--ok);color:#86efac;font-weight:700}
.opt.no{background:rgba(244,63,94,.1);border-color:var(--no);color:#fda4af;font-weight:700}
.opt:disabled{cursor:default}
.qexp{background:rgba(34,197,94,.05);border:1px solid rgba(34,197,94,.2);border-radius:var(--r2);padding:14px 17px;margin:12px 0;font-size:13px;color:#86efac;line-height:1.75;}
.qexp strong{color:var(--ok)}
.btn{background:linear-gradient(135deg,var(--v),var(--v3));color:#fff;border:none;border-radius:var(--r2);padding:12px 24px;font-size:14px;font-weight:700;cursor:pointer;font-family:'Syne',sans-serif;transition:all .22s;letter-spacing:.2px;}
.btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(124,92,252,.45)}
.btn:disabled{background:var(--dim);cursor:not-allowed;transform:none;box-shadow:none}
.btn-w{width:100%}
.btn-out{background:var(--ink4);border:1px solid var(--line2);color:var(--sub);border-radius:8px;padding:6px 16px;cursor:pointer;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;transition:all .2s;}
.btn-out:hover{border-color:var(--v);color:var(--txt)}
.quiz-done{text-align:center;padding:52px 32px;background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);}
.qd-emoji{font-size:64px;margin-bottom:18px;line-height:1;display:block}
.qd-h{font-family:'Instrument Serif',serif;font-size:30px;margin-bottom:8px}
.qd-score{font-size:52px;font-weight:900;font-family:'DM Mono',monospace;margin:8px 0;line-height:1}
.qd-p{color:var(--sub);font-size:14px;margin-bottom:26px;line-height:1.6}

/* REDA√á√ÉO */
.essay-wrap{max-width:920px;margin:0 auto}
.etopics{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:24px}
.etcard{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);padding:20px;cursor:pointer;transition:all .22s;position:relative;overflow:hidden;}
.etcard::before{content:"";position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:2px 0 0 2px;background:var(--c,var(--v))}
.etcard:hover{border-color:var(--line3);transform:translateY(-2px);box-shadow:var(--sh)}
.et-tipo{font-size:10px;font-weight:700;font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px;display:block}
.et-titulo{color:var(--txt);font-size:14px;line-height:1.5;font-weight:700;margin-bottom:8px}
.et-dica{color:var(--sub);font-size:12px;line-height:1.55}
.essay-header{display:flex;align-items:center;gap:12px;margin-bottom:18px;flex-wrap:wrap}
.tipbox{background:linear-gradient(135deg,rgba(124,92,252,.07),rgba(124,92,252,.03));border:1px solid rgba(124,92,252,.18);border-radius:var(--r);padding:15px 19px;margin-bottom:14px;font-size:13px;color:var(--sub);line-height:1.75;}
.tipbox strong{color:var(--v2)}
.comp5{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:14px;background:var(--ink3);border:1px solid var(--line);border-radius:var(--r2);padding:12px 16px;align-items:center;}
.ctag{background:var(--ink4);border:1px solid var(--line2);border-radius:6px;padding:3px 10px;font-size:11px;font-weight:700;color:var(--dim);}
.textwrap{position:relative}
textarea{width:100%;min-height:340px;background:var(--ink3);border:1px solid var(--line2);border-radius:var(--r);padding:22px 24px;color:var(--txt);font-size:15px;line-height:1.85;font-family:'Syne',sans-serif;resize:vertical;outline:none;transition:border-color .2s;}
textarea:focus{border-color:var(--v)}
textarea::placeholder{color:var(--dim)}
.essay-toolbar{display:flex;justify-content:space-between;align-items:center;margin-top:12px;flex-wrap:wrap;gap:12px;}
.wc{font-size:12px;color:var(--sub);font-family:'DM Mono',monospace}
.essay-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn-copy{background:var(--ink4);border:1px solid var(--line2);color:var(--sub);border-radius:8px;padding:9px 16px;cursor:pointer;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;transition:all .2s;display:flex;align-items:center;gap:6px;}
.btn-copy:hover{border-color:var(--cy);color:var(--cy)}
.btn-pdf{background:linear-gradient(135deg,#854d0e,var(--go));color:#1a0f00;border:none;border-radius:8px;padding:9px 16px;cursor:pointer;font-family:'Syne',sans-serif;font-size:12px;font-weight:800;transition:all .2s;display:flex;align-items:center;gap:6px;}
.btn-pdf:hover{transform:translateY(-1px);box-shadow:0 5px 18px rgba(240,180,41,.35)}
.btn-save{background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.35);color:var(--ok);border-radius:8px;padding:9px 16px;cursor:pointer;font-family:'Syne',sans-serif;font-size:12px;font-weight:800;transition:all .2s;display:flex;align-items:center;gap:6px;}
.btn-save:hover{background:rgba(34,197,94,.25);transform:translateY(-1px)}
.btn-save:disabled{opacity:.5;cursor:not-allowed;transform:none}
.copy-toast{position:fixed;bottom:28px;right:28px;z-index:1000;background:var(--ok);color:#001a0a;border-radius:10px;padding:12px 20px;font-size:13px;font-weight:700;box-shadow:var(--sh2);transform:translateY(80px);opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1);pointer-events:none;}
.copy-toast.show{transform:translateY(0);opacity:1}

/* Feedback IA */
.efb{margin-top:22px;background:var(--ink2);border:1px solid rgba(124,92,252,.22);border-radius:var(--r);padding:26px;}
.efb-title{color:var(--v2);font-size:15px;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.score-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:9px;margin-bottom:20px}
@media(max-width:600px){.score-grid{grid-template-columns:repeat(2,1fr)}}
.score-card{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r2);padding:12px;text-align:center;}
.score-n{font-size:24px;font-weight:900;font-family:'DM Mono',monospace;color:var(--v2);line-height:1}
.score-lbl{font-size:9px;color:var(--sub);margin-top:4px;line-height:1.4}
.efb-text{font-size:13px;line-height:1.85;color:#c0b8d8;white-space:pre-wrap}
.loading-dots{display:flex;gap:6px;justify-content:center;padding:28px;align-items:center}
.loading-dots span{width:8px;height:8px;border-radius:50%;background:var(--v);animation:dot .9s ease-in-out infinite}
.loading-dots span:nth-child(2){animation-delay:.15s;background:var(--v2)}
.loading-dots span:nth-child(3){animation-delay:.3s;background:var(--go)}
@keyframes dot{0%,80%,100%{transform:scale(.7);opacity:.4}40%{transform:scale(1);opacity:1}}

/* REDA√á√ïES SALVAS */
.saved-essays{margin-top:28px}
.saved-title{font-family:'Instrument Serif',serif;font-size:20px;color:var(--txt);margin-bottom:14px;display:flex;align-items:center;gap:10px;}
.saved-title span{font-size:11px;color:var(--sub);font-family:'DM Mono',monospace;font-style:normal;}
.essay-list{display:flex;flex-direction:column;gap:10px;}
.essay-item{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);padding:16px 20px;display:flex;align-items:center;gap:14px;flex-wrap:wrap;}
.essay-item-info{flex:1;min-width:0;}
.essay-item-title{font-size:13px;font-weight:700;color:var(--txt);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px;}
.essay-item-meta{font-size:11px;color:var(--sub);font-family:'DM Mono',monospace;}
.essay-item-score{font-size:20px;font-weight:900;font-family:'DM Mono',monospace;white-space:nowrap;}
.essay-item-actions{display:flex;gap:7px;flex-shrink:0;}
.btn-sm{background:var(--ink4);border:1px solid var(--line2);color:var(--sub);border-radius:7px;padding:5px 12px;cursor:pointer;font-family:'Syne',sans-serif;font-size:11px;font-weight:700;transition:all .2s;white-space:nowrap;}
.btn-sm:hover{border-color:var(--v);color:var(--txt)}
.btn-sm.danger:hover{border-color:var(--no);color:var(--no)}
.essay-detail{background:var(--ink2);border:1px solid var(--line2);border-radius:var(--r);padding:20px;margin-top:10px;}
.essay-detail-text{font-size:13px;line-height:1.8;color:#c0b8d8;white-space:pre-wrap;max-height:260px;overflow-y:auto;margin-bottom:14px;padding-right:6px;}

/* PROVAS */
.exams-wrap{max-width:1200px;margin:0 auto}
.pdf-hero{background:linear-gradient(135deg,rgba(124,92,252,.1),rgba(240,180,41,.06));border:1px solid var(--line2);border-radius:var(--r3);padding:28px 32px;margin-bottom:28px;position:relative;overflow:hidden;}
.pdf-hero::before{content:"UNESP";position:absolute;right:-10px;top:-20px;font-family:'Instrument Serif',serif;font-size:120px;color:rgba(255,255,255,.025);pointer-events:none;line-height:1;font-style:italic;}
.pdf-h3{font-family:'Instrument Serif',serif;font-size:22px;color:var(--go2);margin-bottom:5px}
.pdf-p{color:var(--sub);font-size:12px;line-height:1.6;margin-bottom:20px}
.pdf-acts{display:flex;gap:9px;flex-wrap:wrap}
.pdf-gold{background:linear-gradient(135deg,#92400e,var(--go));color:#1a0e00;border:none;border-radius:10px;padding:12px 22px;font-size:13px;font-weight:800;cursor:pointer;font-family:'Syne',sans-serif;text-decoration:none;display:inline-flex;align-items:center;gap:8px;transition:all .2s;}
.pdf-gold:hover{transform:translateY(-1px);box-shadow:0 7px 24px rgba(240,180,41,.35)}
.pdf-sec{background:var(--ink4);border:1px solid var(--line2);color:var(--sub);border-radius:9px;padding:10px 17px;cursor:pointer;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;transition:all .2s;text-decoration:none;display:inline-flex;align-items:center;gap:7px;}
.pdf-sec:hover{border-color:var(--v);color:var(--txt)}
.pdf-viewer{display:none;margin-top:16px;border-radius:12px;overflow:hidden;border:1px solid var(--line2)}
.pdf-viewer iframe{width:100%;height:740px;border:none;background:#fff}
.egrid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
@media(max-width:768px){.egrid{grid-template-columns:1fr}}
.exam-card{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);overflow:hidden;transition:all .3s;}
.exam-card:hover{border-color:var(--line2);box-shadow:var(--sh)}
.exam-head{padding:22px;background:linear-gradient(135deg,var(--ink4),var(--ink3));display:flex;justify-content:space-between;align-items:flex-start}
.ebadge{background:var(--v);color:#fff;border-radius:6px;padding:3px 10px;font-size:10px;font-weight:800;letter-spacing:.4px}
.eyear{font-size:44px;font-weight:900;font-family:'DM Mono',monospace;line-height:1}
.exam-body{padding:18px 22px}
.estats{display:flex;gap:10px;margin-bottom:14px}
.estat{background:var(--ink2);border-radius:8px;padding:8px 12px;text-align:center;flex:1}
.estat-n{font-size:20px;font-weight:900;font-family:'DM Mono',monospace}
.estat-l{font-size:10px;color:var(--sub);margin-top:1px}
.exam-hl{color:var(--sub);font-size:11px;line-height:1.6;margin-bottom:13px}
.etags{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:14px}
.etog{width:100%;background:var(--ink2);border:1px solid var(--line);color:var(--sub);border-radius:8px;padding:10px;cursor:pointer;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;transition:all .2s}
.etog:hover{border-color:var(--v);color:var(--txt)}
.eqs{max-height:0;overflow:hidden;transition:max-height .5s ease}
.eqs.open{max-height:8000px}
.qitem{background:var(--ink2);border:1px solid var(--line);border-radius:var(--r2);padding:15px;margin-top:10px}
.qitem-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;flex-wrap:wrap;gap:6px}
.qnum{background:var(--ink4);color:var(--v2);border-radius:5px;padding:2px 8px;font-size:10px;font-weight:700;font-family:'DM Mono',monospace}
.qitem p{color:var(--sub);font-size:13px;line-height:1.6;margin-bottom:11px}
.qopts{display:flex;flex-direction:column;gap:6px}
.qopt{background:var(--ink3);border:1px solid var(--line);color:var(--dim);border-radius:7px;padding:9px 13px;cursor:pointer;font-family:'Syne',sans-serif;font-size:12px;text-align:left;transition:all .2s;font-weight:600}
.qopt:hover:not(:disabled){border-color:var(--v)}
.qopt.ok{background:rgba(34,197,94,.09);border-color:var(--ok);color:#86efac;font-weight:700}
.qopt.no{background:rgba(244,63,94,.09);border-color:var(--no);color:#fda4af;font-weight:700}
.qopt:disabled{cursor:default}
.qexp2{background:rgba(34,197,94,.05);border:1px solid rgba(34,197,94,.18);border-radius:7px;padding:11px;margin-top:8px;font-size:12px;color:#86efac;line-height:1.6;display:none}
.qexp2.show{display:block}

/* PROGRESSO */
.stat-nums{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:28px}
.sn{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);padding:18px;text-align:center}
.sn-num{font-size:36px;font-weight:900;font-family:'DM Mono',monospace;line-height:1}
.sn-lbl{font-size:11px;color:var(--sub);margin-top:4px}
.sn-sub{font-size:10px;color:var(--dim);margin-top:2px}
.mat-list{display:flex;flex-direction:column;gap:9px}
.mat-row{background:var(--ink3);border:1px solid var(--line);border-radius:var(--r);padding:14px 18px;display:flex;align-items:center;gap:15px}
.pbar{height:5px;background:var(--line2);border-radius:3px;overflow:hidden;flex:1}
.pfill{height:100%;border-radius:3px;transition:width .7s cubic-bezier(.4,0,.2,1)}

/* SCROLLBAR */
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:var(--ink)}
::-webkit-scrollbar-thumb{background:var(--ink4);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--v)}

/* PRINT */
@media print{
  .hdr,.nav,.essay-toolbar,.essay-header,.tipbox,.comp5,.btn,.btn-copy,.btn-pdf,.btn-out,.btn-save,.efb,.fbar,.saved-essays{display:none!important}
  body{background:#fff!important;color:#000!important}
  textarea{border:none!important;padding:0!important;font-size:12pt!important;line-height:1.8!important;height:auto!important;min-height:unset!important;color:#000!important;background:#fff!important;font-family:Georgia,serif!important}
  .essay-wrap{max-width:100%!important;padding:20mm!important}
  .print-header{display:block!important}
}
.print-header{display:none;border-bottom:2px solid #000;padding-bottom:12px;margin-bottom:24px}
.print-header h2{font-size:18pt;font-family:Georgia,serif}
.print-header p{font-size:10pt;color:#555;margin-top:4px}

/* MOBILE */
@media(max-width:640px){
  .hdr-pills{display:none}
  .main{padding:20px 16px 60px}
  .cgrid{grid-template-columns:1fr}
  .etopics{grid-template-columns:1fr}
  .score-grid{grid-template-columns:repeat(3,1fr)}
}
</style>
</head>
<body>

<div class="copy-toast" id="toast">‚úì Texto copiado!</div>

<header class="hdr">
  <div class="hdr-in">
    <div class="brand">
      <div class="brand-mark">üìö</div>
      <div>
        <div class="brand-name">UNESP Study Hub</div>
        <div class="brand-sub">Exatas & Humanidades ¬∑ 2022</div>
      </div>
    </div>
    <div class="hdr-pills">
      <div class="pill">Cards: <b id="stCards">0/0</b></div>
      <div class="pill">Quiz: <b id="stQuiz">0%</b></div>
      <div class="pill">N√≠vel: <b id="stDiff">Todos</b></div>
      <div class="fb-badge" id="uid-badge">üîÑ Conectando...</div>
    </div>
    <div class="fb-status" id="fb-status"></div>
  </div>
</header>

<nav class="nav">
  <div class="nav-in">
    <button class="nb on" onclick="goTab('flashcards')">üÉè Flashcards</button>
    <button class="nb" onclick="goTab('quiz')">üéØ Quiz</button>
    <button class="nb" onclick="goTab('essay')">‚úçÔ∏è Reda√ß√£o</button>
    <button class="nb" onclick="goTab('exams')">üìÑ Provas</button>
    <button class="nb" onclick="goTab('stats')">üìä Progresso</button>
  </div>
</nav>

<main class="main">
  <div id="farea"></div>
  <div class="tab active" id="tab-flashcards">
    <div class="sec-hd">
      <div class="sec-title">Flashcards de Revis√£o</div>
      <div class="sec-sub">Clique no card para revelar a resposta ¬∑ Progresso salvo automaticamente no Firebase</div>
    </div>
    <div id="fcprog" class="prog-strip" style="display:none"></div>
    <div class="cgrid" id="cgrid"></div>
  </div>
  <div class="tab" id="tab-quiz"><div class="quiz-wrap" id="qwrap"></div></div>
  <div class="tab" id="tab-essay"><div class="essay-wrap" id="ewrap"></div></div>
  <div class="tab" id="tab-exams"><div class="exams-wrap" id="xwrap"></div></div>
  <div class="tab" id="tab-stats"><div id="swrap"></div></div>
</main>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DADOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const COR={Biologia:"#22c55e",Qu√≠mica:"#f0b429",F√≠sica:"#3b82f6",Matem√°tica:"#8b5cf6",Geografia:"#10b981",Hist√≥ria:"#ef4444",Literatura:"#ec4899",Filosofia:"#06b6d4",Reda√ß√£o:"#a855f7",Ingl√™s:"#fb923c"};

const CARDS=[
  {id:1,s:"Biologia",d:1,q:"O que √© G6PD e por que sua defici√™ncia impede uso de primaquina?",a:"G6PD protege eritr√≥citos do estresse oxidativo. Sem ela, a primaquina causa hem√≥lise (destrui√ß√£o dos gl√≥bulos vermelhos), podendo ser fatal. Portadores precisam de antimal√°ricos alternativos."},
  {id:2,s:"Biologia",d:2,q:"Quais s√£o as 3 fases da depend√™ncia tecnol√≥gica em adolescentes?",a:"‚ë† Engajamento: uso intenso e prazeroso; ‚ë° Substitui√ß√£o: tecnologia substitui atividades reais; ‚ë¢ Depend√™ncia: s√≠ndrome de abstin√™ncia sem o dispositivo ‚Äî ansiedade, irritabilidade, ins√¥nia."},
  {id:3,s:"Biologia",d:2,q:"Rela√ß√£o entre press√£o e velocidade do sangue nos vasos.",a:"Inversamente proporcionais. Capilares: baixa velocidade (maior √°rea total) + baixa press√£o ‚Üí troca de nutrientes. Art√©rias: alta press√£o + alta velocidade. Veias: baixa press√£o, retorno por m√∫sculos e v√°lvulas."},
  {id:4,s:"Biologia",d:1,q:"Como foi criada a alm√¥ndega de mamute em 2023?",a:"Gene da mioglobina do mamute sequenciado ‚Üí partes ausentes preenchidas com DNA de elefante africano ‚Üí gene inserido em c√©lula-tronco de ovelha ‚Üí c√©lulas multiplicadas em biorreator por 3 semanas."},
  {id:5,s:"Biologia",d:3,q:"Por que a radia√ß√£o ionizante causa feridas que n√£o cicatrizam?",a:"Muta√ß√µes no DNA das c√©lulas epiteliais alteram o ciclo celular ‚Üí necrose ou transforma√ß√£o neopl√°sica. C√©lulas-tronco epid√©rmicas tamb√©m danificadas impedem renova√ß√£o normal. Limiar de dose acima de 6 Gy causa s√≠ndrome cut√¢nea por radia√ß√£o."},
  {id:6,s:"Biologia",d:1,q:"Diferen√ßa fundamental entre mitose e meiose.",a:"Mitose: 1 divis√£o ‚Üí 2 c√©lulas id√™nticas diploides (2n). Crescimento e repara√ß√£o. Meiose: 2 divis√µes ‚Üí 4 c√©lulas haploides (n). Forma√ß√£o de gametas. Gera variabilidade gen√©tica por crossing-over."},
  {id:7,s:"Biologia",d:2,q:"O que √© fototropismo e qual horm√¥nio o controla?",a:"Crescimento direcional em resposta √† luz. Auxina (AIA) acumula-se no lado n√£o iluminado ‚Üí alongamento celular ‚Üí curvatura em dire√ß√£o √† luz. Demonstrado por Darwin em 1880 com cole√≥ptiles de aveia."},
  {id:8,s:"Biologia",d:3,q:"Como funciona o feedback negativo na regula√ß√£o da tireoide?",a:"Hipot√°lamo libera TRH ‚Üí Hip√≥fise libera TSH ‚Üí Tireoide produz T3/T4. Altos n√≠veis de T3/T4 inibem hipot√°lamo e hip√≥fise. An√°logo a um termostato: produto final regula sua pr√≥pria s√≠ntese."},
  {id:9,s:"Biologia",d:2,q:"O que diferencia v√≠rus de bact√©rias no tratamento?",a:"V√≠rus: sem metabolismo pr√≥prio, n√£o respondem a antibi√≥ticos ‚Üí antivirais e vacinas. Bact√©rias: procariotos com metabolismo pr√≥prio ‚Üí antibi√≥ticos (ex: penicilina inibe s√≠ntese de parede celular). Gripes s√£o virais ‚Äî antibi√≥ticos n√£o funcionam!"},
  {id:10,s:"Biologia",d:3,q:"O que √© epistasia e como difere de domin√¢ncia?",a:"Domin√¢ncia: alelo mascara outro no mesmo locus (mesmo gene). Epistasia: gene mascara outro gene em locus diferente (genes distintos). Ex.: gene I em c√£es mascara gene B ‚Äî intera√ß√£o entre loci diferentes no genoma."},
  {id:11,s:"Qu√≠mica",d:1,q:"Como se forma o oz√¥nio troposf√©rico (poluente)?",a:"NO‚ÇÇ + luz UV ‚Üí NO + O¬∑; O¬∑ + O‚ÇÇ ‚Üí O‚ÇÉ. Poluente: irrita vias respirat√≥rias, danifica tecido pulmonar. Diferente do oz√¥nio estratosf√©rico, que nos protege da UV. Origem: combust√£o de ve√≠culos."},
  {id:12,s:"Qu√≠mica",d:1,q:"O que √© o efeito fotoel√©trico e por que foi revolucion√°rio?",a:"Emiss√£o de el√©trons de metal iluminado. Depende da FREQU√äNCIA (n√£o intensidade) da luz. Einstein explicou com f√≥tons (E=hf) em 1905 ‚Äî base da mec√¢nica qu√¢ntica. Lhe rendeu o Nobel de 1921."},
  {id:13,s:"Qu√≠mica",d:3,q:"Por que o pH pode ser negativo? A escala 0-14 tem limite?",a:"N√£o tem limite f√≠sico. pH = ‚àílog[H‚Å∫]. Se [H‚Å∫] > 1 mol/L (√°cido concentrado), pH < 0. A escala 0-14 √© apenas convencional para solu√ß√µes dilu√≠das (‚âà25¬∞C). pH de √°cido sulf√∫rico concentrado ‚âà ‚àí1,5."},
  {id:14,s:"Qu√≠mica",d:2,q:"Por que a Pt daria 'falso positivo' no teste de dissolu√ß√£o em √°cido?",a:"E¬∞(Pt) = +1,20V > E¬∞(H‚Å∫) = 0V. Como o √°cido precisaria oxidar a platina, mas n√£o tem potencial suficiente, ela n√£o se dissolve. Falso positivo = n√£o reage, como o ouro (E¬∞=+1,50V). S√≥ √°gua r√©gia dissolve."},
  {id:15,s:"Qu√≠mica",d:2,q:"Princ√≠pio de Le Chatelier: aumento de press√£o com mais moles nos produtos.",a:"Equil√≠brio desloca para o lado com MENOS moles de g√°s (reagentes), reduzindo a press√£o. Ex.: N‚ÇÇ + 3H‚ÇÇ ‚áå 2NH‚ÇÉ ‚Äî press√£o alta favorece NH‚ÇÉ (2 moles < 4 moles). Base do processo Haber."},
  {id:16,s:"Qu√≠mica",d:1,q:"Diferen√ßa entre endot√©rmica e exot√©rmica. Exemplos.",a:"Exot√©rmica: libera calor (ŒîH < 0). Ex.: combust√£o, respira√ß√£o celular. Endot√©rmica: absorve calor (ŒîH > 0). Ex.: fotoss√≠ntese, fus√£o do gelo, cozimento do p√£o. Elevar T favorece a endot√©rmica (Le Chatelier)."},
  {id:17,s:"Qu√≠mica",d:2,q:"Como calcular moles? Exemplo com 36g de √°gua.",a:"n = m/M. M(H‚ÇÇO) = 2√ó1 + 16 = 18 g/mol. n = 36/18 = 2 mol. 2 mol = 2 √ó 6,02√ó10¬≤¬≥ = 1,204√ó10¬≤‚Å¥ mol√©culas. Cada mol cont√©m o n√∫mero de Avogadro de part√≠culas."},
  {id:18,s:"Qu√≠mica",d:3,q:"Por que compostos i√¥nicos t√™m alto ponto de fus√£o?",a:"Formados por c√°tions e √¢nions em rede cristalina (ex.: NaCl). For√ßas eletrost√°ticas entre √≠ons opostos s√£o muito intensas e omnidirecionais. Exigem muita energia para romper ‚Äî pf NaCl = 801¬∞C."},
  {id:19,s:"F√≠sica",d:1,q:"Mistura caf√© (80¬∞C) + leite (20¬∞C), propor√ß√£o 1:1. Temperatura final?",a:"50¬∞C. Equil√≠brio t√©rmico: m¬∑c¬∑(80‚àíT) = m¬∑c¬∑(T‚àí20). Massas e calores espec√≠ficos iguais ‚Üí T = (80+20)/2 = 50¬∞C."},
  {id:20,s:"F√≠sica",d:2,q:"O que Newton descobriu sobre velocidade orbital e gravidade?",a:"Para orbitar a Terra, proj√©til precisa de velocidade tangencial v = ‚àö(g¬∑R) ‚âà 7,9 km/s. Nessa velocidade, a queda livre curva ao redor do planeta. Acima disso: elipse/escape. Abaixo: cai."},
  {id:21,s:"F√≠sica",d:2,q:"No term√¥metro de √≥leo (M=18g, V=20cm¬≥), quando a tens√£o no fio se anula?",a:"Quando Empuxo = Peso: œÅ_√≥leo √ó V √ó g = M √ó g ‚Üí œÅ_√≥leo = 18/20 = 0,90 g/cm¬≥. Pelo gr√°fico, 0,90 g/cm¬≥ corresponde a ‚âà100¬∞C. Nessa temperatura o objeto flutua sem tens√£o."},
  {id:22,s:"F√≠sica",d:1,q:"Por que a fuligem desaparece das paredes do forno na temperatura ideal?",a:"Fuligem = carbono da combust√£o incompleta. Na temperatura ideal: C + O‚ÇÇ ‚Üí CO‚ÇÇ(g). O carbono s√≥lido √© oxidado a g√°s que escapa."},
  {id:23,s:"F√≠sica",d:3,q:"O que √© o efeito Doppler? Cite 3 aplica√ß√µes.",a:"Varia√ß√£o de frequ√™ncia percebida com movimento relativo fonte-observador. Aplica√ß√µes: ‚ë† Radar de velocidade; ‚ë° Ecografia Doppler (fluxo sangu√≠neo); ‚ë¢ Medi√ß√£o de velocidade de estrelas (desvio para vermelho)."},
  {id:24,s:"F√≠sica",d:2,q:"Diferen√ßa entre calor latente e calor sens√≠vel.",a:"Sens√≠vel: Q = m¬∑c¬∑ŒîT ‚Äî muda temperatura, n√£o muda fase. Latente: Q = m¬∑L ‚Äî muda fase sem alterar temperatura. Ex.: gelo a 0¬∞C absorve L_fus√£o = 80 cal/g at√© fundir completamente."},
  {id:25,s:"F√≠sica",d:3,q:"In√©rcia e 1¬™ Lei de Newton ‚Äî qual a diferen√ßa entre elas?",a:"A 1¬™ Lei √© a LEI: corpo sem for√ßa resultante permanece em repouso ou MRU. A in√©rcia √© a PROPRIEDADE que descreve esse comportamento ‚Äî resist√™ncia √† mudan√ßa de estado. A massa √© a medida quantitativa da in√©rcia."},
  {id:26,s:"Matem√°tica",d:2,q:"Diferen√ßa de combina√ß√µes entre placas Mercosul e antigas.",a:"Mercosul: 3 letras + 1 n√∫mero + 3 letras ‚Üí 26¬≥√ó10√ó26¬≥. Antiga: 3 letras + 4 n√∫meros ‚Üí 26¬≥√ó10‚Å¥. Raz√£o = 26¬≥/10¬≥ ‚âà 17,6√ó. Mercosul tem muito mais combina√ß√µes."},
  {id:27,s:"Matem√°tica",d:1,q:"O que s√£o n√∫meros oblongos e qual √© a f√≥rmula?",a:"Pontos em ret√¢ngulo onde colunas = linhas + 1. F√≥rmula: O(n) = n(n+1). Sequ√™ncia: 2, 6, 12, 20, 30, 42... Sempre o dobro do triangular correspondente: O(n) = 2¬∑T(n)."},
  {id:28,s:"Matem√°tica",d:2,q:"Prove que 210 √© triangular E oblongo.",a:"T(20) = 20√ó21/2 = 210 ‚úì. O(14) = 14√ó15 = 210 ‚úì. √â os dois. Os pares (n,m) satisfazem a equa√ß√£o de Pell."},
  {id:29,s:"Matem√°tica",d:3,q:"Converta 2021 para bin√°rio e compare os d√≠gitos 1 e 0.",a:"2021 = 11111100101‚ÇÇ. Sete 1s e quatro 0s. Diferen√ßa = 7‚àí4 = 3."},
  {id:30,s:"Matem√°tica",d:1,q:"Como calcular probabilidade condicional?",a:"P(A|B) = P(A‚à©B)/P(B). Ex.: P(press√£o elevada | excesso de peso) = P(elevada ‚à© excesso)/P(excesso) = 0,10/0,25 = 40%."},
  {id:31,s:"Matem√°tica",d:3,q:"Modelo exponencial de pre√ßo de baterias (UNESP 2022).",a:"y = 15649¬∑e^(‚àí0,687x), x = anos desde introdu√ß√£o. Para 2021: ‚âà US$64. A fun√ß√£o modela decrescimento exponencial."},
  {id:32,s:"Matem√°tica",d:2,q:"F√≥rmula e propriedade-chave dos n√∫meros triangulares.",a:"T(n) = n(n+1)/2. T(1)=1, T(2)=3, T(3)=6... Propriedade: T(n)‚àíT(n‚àí1)=n. T(10)=55, T(20)=210, T(100)=5050 (Gauss!)."},
  {id:33,s:"Geografia",d:1,q:"Por que o Canal de Suez √© estrat√©gico para o com√©rcio mundial?",a:"Liga Mediterr√¢neo ao Mar Vermelho ‚Äî evita contornar a √Åfrica (‚âà7.000km a menos, 9 dias). Passa 12% do com√©rcio mundial. Bloqueio de 2021 = US$9,6 bi/dia."},
  {id:34,s:"Geografia",d:2,q:"O que √© a Serra do Imeri e por que favorece endemismo?",a:"Serra vulc√¢nica no norte do AM. Isolamento geogr√°fico (montanhas + floresta) separa popula√ß√µes ‚Üí especia√ß√£o alop√°trica. Alt√≠ssimo endemismo vegetal e de anf√≠bios."},
  {id:35,s:"Geografia",d:1,q:"O que √© subsid√™ncia do terreno? Causa antr√≥pica.",a:"Rebaixamento lento e gradual do solo. Causa antr√≥pica principal: superexplora√ß√£o de aqu√≠feros. Cidade do M√©xico afunda 9cm/ano; Jacarta afundou 4m em 30 anos."},
  {id:36,s:"Geografia",d:2,q:"Reservas Extrativistas: origem, criador e objetivo.",a:"Criadas por Chico Mendes (1988). Permitem explora√ß√£o sustent√°vel por popula√ß√µes tradicionais (seringueiros, ribeirinhos). Conciliam conserva√ß√£o e renda."},
  {id:37,s:"Geografia",d:3,q:"Meio t√©cnico-cient√≠fico-informacional de Milton Santos.",a:"√âpoca atual (anos 1970+): ci√™ncia, t√©cnica e informa√ß√£o fundem-se no territ√≥rio. No Brasil: distribui√ß√£o desigual ‚Äî cont√≠nua no Centro-Sul; pontual no Norte e Nordeste."},
  {id:38,s:"Hist√≥ria",d:1,q:"Quem foi Antonio Conselheiro e o que foi Canudos?",a:"L√≠der messi√¢nico que fundou Canudos (BA, 1893-97), reunindo ~30.000 pessoas marginalizadas. Destru√≠da em 4 expedi√ß√µes militares. Euclides da Cunha narrou em 'Os Sert√µes' (1902)."},
  {id:39,s:"Hist√≥ria",d:2,q:"Revolta dos Mal√™s (1835): o que foi e por que √© √∫nica?",a:"Maior revolta urbana de escravizados das Am√©ricas. Liderada por escravizados mu√ßulmanos (os Mal√™s) alfabetizados em √°rabe. Planejada para o fim do Ramad√£. Reprimida: morte, deporta√ß√£o, a√ßoite."},
  {id:40,s:"Hist√≥ria",d:1,q:"Como a Crise de 1929 transformou o liberalismo econ√¥mico?",a:"Evidenciou os limites do laissez-faire. Resultado: New Deal de Roosevelt, pol√≠ticas keynesianas. Estado passou a regular mercados e garantir empregos."},
  {id:41,s:"Hist√≥ria",d:2,q:"Governo JK e o Plano de Metas.",a:"'50 anos em 5': industrializa√ß√£o acelerada com capital estrangeiro, energia (Furnas, Paulo Afonso) e constru√ß√£o de Bras√≠lia (1960). Resultado: crescimento acelerado + infla√ß√£o + d√≠vida externa."},
  {id:42,s:"Hist√≥ria",d:3,q:"O que a charge de Belmonte ironizava sobre a Semana de Arte Moderna de 1922?",a:"O descompasso entre vanguarda e gosto do p√∫blico burgu√™s. Ironia: quem n√£o entendia a renova√ß√£o eram os espectadores conservadores, n√£o os artistas."},
  {id:43,s:"Hist√≥ria",d:2,q:"O que o texto de Proudhon representa politicamente?",a:"'A propriedade √© o roubo' (1840) √© marco do Anarquismo. Defende aboli√ß√£o da propriedade privada e do Estado."},
  {id:44,s:"Hist√≥ria",d:3,q:"Impacto demogr√°fico da escravid√£o no Rec√¥ncavo Baiano.",a:"Escravizados chegaram a 75%+ da popula√ß√£o. Taxa de crescimento negativo exigia importa√ß√£o constante de africanos. Com fim do tr√°fico em 1850, acelerou-se a imigra√ß√£o europeia."},
  {id:45,s:"Literatura",d:1,q:"'√â tempo de formar novos quilombos' (Concei√ß√£o Evaristo) ‚Äî que figura de linguagem?",a:"Met√°fora. Os quilombos representam metaforicamente a resist√™ncia e uni√£o coletiva contempor√¢nea."},
  {id:46,s:"Literatura",d:2,q:"Em 'Dois Irm√£os' (Hatoum), qual √© o resultado da rivalidade Yaqub √ó Omar?",a:"Desagrega√ß√£o total da fam√≠lia. Os g√™meos destroem progressivamente os la√ßos afetivos e materiais. Nael √© testemunha da ru√≠na."},
  {id:47,s:"Literatura",d:2,q:"Qual recurso produz efeito c√¥mico no di√°logo do burro no 'Mac√°rio'?",a:"Ambiguidade lexical. 'Burro' = animal e insulto, gerando s√©rie de mal-entendidos progressivos e absurdos."},
  {id:48,s:"Literatura",d:1,q:"Qual movimento reage ao iluminismo valorizando 'o valor supremo da experi√™ncia individual'?",a:"Romantismo (s√©c. XIX). No Brasil: Gon√ßalves Dias (indianismo), Jos√© de Alencar (prosa), √Ålvares de Azevedo (gera√ß√£o byroniana)."},
  {id:49,s:"Literatura",d:3,q:"O paradoxo em 'O Sobrevivente' de Drummond.",a:"O poema declara imposs√≠vel escrever poesia no mundo mecanizado ‚Äî mas o pr√≥prio texto √© uma poesia. O negativo se transforma em ato afirmativo."},
  {id:50,s:"Filosofia",d:2,q:"O que √© 'fortuna' em Maquiavel e como o pr√≠ncipe deve lidar com ela?",a:"Fortuna = acaso, eventos imprevistos. O pr√≠ncipe com virt√π deve antecipar e adaptar-se. Analogia: construir diques antes da cheia."},
  {id:51,s:"Filosofia",d:1,q:"O que √© o pan√≥ptico e por que Foucault o usa como met√°fora?",a:"Pris√£o circular de Bentham: torre central v√™ todos, ningu√©m sabe se est√° sendo observado ‚Üí auto-vigil√¢ncia permanente. Foucault: met√°fora do poder disciplinar moderno."},
  {id:52,s:"Filosofia",d:3,q:"Cr√≠tica de Plat√£o √†s artes em 'A Rep√∫blica'.",a:"Artistas imitam o mundo sens√≠vel (j√° c√≥pia das Ideias) ‚Üí arte √© 'c√≥pia de c√≥pia'. Apelam √†s emo√ß√µes, contornando a raz√£o ‚Üí corrompem a alma. Plat√£o expulsaria poetas da cidade ideal."},
  {id:53,s:"Reda√ß√£o",d:1,q:"Quais s√£o as 5 compet√™ncias do ENEM para reda√ß√£o?",a:"‚ë† Dom√≠nio da norma culta; ‚ë° Compreens√£o e desenvolvimento do tema; ‚ë¢ Sele√ß√£o e organiza√ß√£o de argumentos; ‚ë£ Mecanismos de coes√£o e coer√™ncia; ‚ë§ Proposta de interven√ß√£o respeitando os Direitos Humanos."},
  {id:54,s:"Reda√ß√£o",d:2,q:"O que deve ter uma proposta de interven√ß√£o completa?",a:"5 elementos: Agente + A√ß√£o + Modo/Meio + Efeito esperado + Finalidade. Deve ser detalhada, vi√°vel e articulada com a tese."},
  {id:55,s:"Reda√ß√£o",d:3,q:"O que diferencia disserta√ß√£o-argumentativa de texto expositivo?",a:"Disserta√ß√£o-argumentativa: defende ponto de vista para convencer. Expositivo: apresenta informa√ß√µes sem tomar partido. O ENEM exige disserta√ß√£o-argumentativa com proposta de interven√ß√£o."},
  {id:56,s:"Ingl√™s",d:1,q:"O que significa 'keep pace' no contexto de urbaniza√ß√£o?",a:"'Keep pace' = manter o ritmo. 'Infrastructure has been unable to keep pace' = a infraestrutura n√£o conseguiu acompanhar o crescimento populacional."},
  {id:57,s:"Ingl√™s",d:2,q:"Diferen√ßa entre 'even though' e 'however' como conectores.",a:"'Even though': conjun√ß√£o subordinativa de concess√£o ‚Äî une duas ora√ß√µes. 'However': adv√©rbio de contraste ‚Äî liga ideias em ora√ß√µes separadas. N√£o s√£o sintaticamente intercambi√°veis."},
];

const QUIZ=[
  {id:1,s:"F√≠sica",d:1,q:"Ma√ß√£ cai de altura h. Energia cin√©tica ao atingir o solo:",opts:["mgh/2","mgh","2mgh","‚àö(2gh)"],ok:1,exp:"Conserva√ß√£o de energia: E. potencial (mgh) converte-se integralmente em E. cin√©tica. Ec = mgh.",src:"UNESP 2022"},
  {id:2,s:"Biologia",d:1,q:"Inser√ß√£o de gene de outra esp√©cie em um organismo chama-se:",opts:["Clonagem","Terapia g√™nica","Transgenia","Sele√ß√£o artificial"],ok:2,exp:"Transgenia = inser√ß√£o de gene de outra esp√©cie. Ex.: gene da insulina humana em E. coli.",src:"UNESP 2022 Q63"},
  {id:3,s:"Hist√≥ria",d:1,q:"Revolta dos Mal√™s (1835) distingue-se por:",opts:["Ter ocorrido no campo","Ser liderada por escravizados alfabetizados em √°rabe","Ter sido bem-sucedida","Ter apoio de fazendeiros"],ok:1,exp:"Os Mal√™s eram escravizados mu√ßulmanos que dominavam a escrita em √°rabe.",src:"UNESP 2022"},
  {id:4,s:"Literatura",d:1,q:"Movimento que defende 'o valor supremo da experi√™ncia individual' contra o iluminismo:",opts:["Naturalismo","Realismo","Barroco","Romantismo"],ok:3,exp:"Romantismo (s√©c. XIX): intui√ß√£o, emo√ß√£o, natureza e p√°tria em contraposi√ß√£o ao racionalismo iluminista.",src:"UNESP 2022 Q15"},
  {id:5,s:"Ingl√™s",d:1,q:"'Keep pace' (Water and Urbanization) significa:",opts:["Antecipar necessidades","Manter o ritmo de progresso","Avaliar a situa√ß√£o","Interferir no desenvolvimento"],ok:1,exp:"'Keep pace' = manter o ritmo. A infraestrutura urbana n√£o conseguiu acompanhar o crescimento populacional.",src:"UNESP 2022 Q26"},
  {id:6,s:"Qu√≠mica",d:1,q:"O efeito fotoel√©trico depende principalmente de:",opts:["Intensidade da luz","Frequ√™ncia da luz","Massa dos el√©trons","Temperatura do metal"],ok:1,exp:"Einstein: emiss√£o de el√©trons depende da FREQU√äNCIA (E=hf), n√£o da intensidade.",src:"UNESP 2022"},
  {id:7,s:"Matem√°tica",d:2,q:"O n√∫mero 210 em rela√ß√£o a triangulares T(n)=n(n+1)/2 e oblongos O(n)=n(n+1):",opts:["Apenas triangular","Apenas oblongo","Triangular E oblongo","Nenhum dos dois"],ok:2,exp:"T(20)=210 ‚úì e O(14)=210 ‚úì. √â ambos! Rela√ß√£o: O(n) = 2¬∑T(n).",src:"UNESP 2022 Q85"},
  {id:8,s:"Biologia",d:2,q:"Hem√°cias + algas em √°gua destilada, centrifuga√ß√£o:",opts:["S√≥ hem√°cias; solu√ß√£o com clorofila","S√≥ algas; solu√ß√£o com hemoglobina","Ambas; sem mol√©culas","Nenhuma; ambas as mol√©culas"],ok:1,exp:"Hem√°cias: sem parede celular ‚Üí lise osm√≥tica ‚Üí hemoglobina na solu√ß√£o. Algas: parede r√≠gida ‚Üí sobrevivem.",src:"UNESP 2022 Q64"},
  {id:9,s:"Qu√≠mica",d:2,q:"No teste do ouro, qual material daria falso positivo?",opts:["Mg (E¬∞= ‚àí2,37V)","Al (E¬∞= ‚àí1,66V)","Fe (E¬∞= ‚àí0,44V)","Pt (E¬∞= +1,20V)"],ok:3,exp:"E¬∞(Pt)=+1,20V > E¬∞(H‚Å∫)=0V ‚Üí √°cido n√£o consegue oxidar a platina.",src:"UNESP 2022"},
  {id:10,s:"Hist√≥ria",d:2,q:"Charge de Belmonte sobre a Semana de Arte Moderna ironiza:",opts:["O atraso da arte","Inexist√™ncia de preocupa√ß√µes populares","O descompasso vanguarda √ó gosto do p√∫blico","A forma√ß√£o t√©cnica dos artistas"],ok:2,exp:"P√∫blico olha os artistas com pena. Ironia: a incompreens√£o era do p√∫blico conservador.",src:"UNESP 2022 Q40"},
  {id:11,s:"F√≠sica",d:2,q:"600g √°gua 10¬∞C + 100g gelo ‚àí40¬∞C + 800g √°gua 5¬∞C. Resultado:",opts:["1500g √°gua a 10¬∞C","1450g √°gua + 50g gelo a 0¬∞C","1500g gelo a ‚àí5¬∞C","1500g √°gua a 0¬∞C"],ok:3,exp:"Q cedido=10000cal. Q p/ aquecer gelo=2000cal + fundir=8000cal. Equil√≠brio: 1500g √°gua a 0¬∞C.",src:"UNESP 2022 Q79"},
  {id:12,s:"Literatura",d:2,q:"Recurso que gera efeito c√¥mico no di√°logo do burro no 'Mac√°rio':",opts:["Ant√≠tese","Eufemismo","Hip√©rbole","Ambiguidade"],ok:3,exp:"'Burro' = animal e insulto. Ambiguidade lexical gera mal-entendidos progressivos.",src:"UNESP 2022 Q04"},
  {id:13,s:"Biologia",d:3,q:"23 nomes populares de aves ‚Äî taxonomicamente:",opts:["23 g√™neros","1 √∫nico g√™nero","23 esp√©cies em 1 g√™nero","1 classe, sem inferir g√™neros"],ok:3,exp:"Todas s√£o aves = mesma classe (Aves). Nomes populares ‚â† nomenclatura cient√≠fica.",src:"UNESP 2022 Q61"},
  {id:14,s:"Qu√≠mica",d:3,q:"SiO‚ÇÇ + 3C ‚Üí SiC + 2CO (rendimento 75%), 6t SiO‚ÇÇ:",opts:["5,6t SiC","4,0t SiC","3,0t SiC","2,5t SiC"],ok:2,exp:"M: SiO‚ÇÇ=60, SiC=40. n=0,1Mmol. Te√≥rico=4t √ó 75%=3t.",src:"UNESP 2022 Q70"},
  {id:15,s:"F√≠sica",d:3,q:"For√ßa gravitacional exoplaneta 2M1207b (5√óMjup) √ó estrela (0,025√óMsol) a 40 UA:",opts:["8,3√ó10¬≤‚Å∞ N","5,0√ó10¬≤‚Å∞ N","2,5√ó10¬≤¬π N","3,6√ó10¬≤¬π N"],ok:0,exp:"F=Gm‚ÇÅm‚ÇÇ/r¬≤. m‚ÇÅ=10¬≤‚Å∏kg; m‚ÇÇ=5√ó10¬≤‚Å∏kg; r=6√ó10¬π¬≤m. F‚âà8,3√ó10¬≤‚Å∞N.",src:"UNESP 2022 Q77"},
  {id:16,s:"Matem√°tica",d:3,q:"P(press√£o elevada | excesso de peso) na tabela:",opts:["12%","4%","50%","40%"],ok:3,exp:"P(A|B) = P(A‚à©B)/P(B) = 10%/25% = 40%. Probabilidade condicional!",src:"UNESP 2022 Q88"},
  {id:17,s:"Filosofia",d:2,q:"Norbert Elias: morte √© problema dos vivos porque:",opts:["Humanos antecipam a pr√≥pria morte","Mortos deixam d√≠vidas","A morte √© imprevis√≠vel","Animais tamb√©m morrem"],ok:0,exp:"S√≥ humanos sabem que morrer√£o e tomam precau√ß√µes diante disso.",src:"UNESP 2022 Q11"},
  {id:18,s:"Biologia",d:2,q:"Horm√¥nio vegetal que controla o fototropismo:",opts:["Giberelina","Citocinina","Etileno","Auxina (AIA)"],ok:3,exp:"Auxina acumula no lado n√£o iluminado ‚Üí elongamento celular ‚Üí curvatura em dire√ß√£o √† luz.",src:"UNESP 2022 Q66"},
];

const ESSAY_TOPICS=[
  {t:"Invisibilidade e registro civil no Brasil",tipo:"ENEM",c:"#7c5cfc",dica:"Paradoxo: sem documentos, cidad√£os s√£o invis√≠veis ao Estado mas vulner√°veis √† exclus√£o social."},
  {t:"Viver em rede no s√©culo XXI",tipo:"ENEM",c:"#06b6d4",dica:"Dualidade: conectividade e acesso √† informa√ß√£o X isolamento social, fake news e depend√™ncia tecnol√≥gica."},
  {t:"Desigualdade de g√™nero no trabalho de cuidado",tipo:"ENEM",c:"#ec4899",dica:"Dado: mulheres realizam 75% do trabalho de cuidado n√£o remunerado. Conecte com mercado de trabalho."},
  {t:"Escassez de semicondutores e soberania tecnol√≥gica",tipo:"FUVEST",c:"#f0b429",dica:"Taiwan produz 90% dos chips avan√ßados. Explore depend√™ncia tecnol√≥gica e guerra comercial EUA-China."},
  {t:"Democratiza√ß√£o do esporte no Brasil",tipo:"FUVEST",c:"#22c55e",dica:"Divis√£o socioecon√¥mica no acesso ao esporte. Use o skate ol√≠mpico como caso de sucesso perif√©rico."},
  {t:"Viol√™ncia contra a mulher no Brasil",tipo:"ENEM",c:"#f43f5e",dica:"Atlas da Viol√™ncia: 1 mulher morta a cada 6h. Causas: patriarcado e depend√™ncia econ√¥mica."},
];

const EXAMS=[{
  id:"u22",nome:"UNESP 2022",ano:"2022",cor:"#f0b429",total:90,
  mats:["Biologia","Qu√≠mica","F√≠sica","Matem√°tica","Geografia","Hist√≥ria","Literatura","Ingl√™s","Filosofia"],
  hl:"G6PD/mal√°ria ¬∑ Placas Mercosul ¬∑ Semana Arte Moderna ¬∑ Revolta Mal√™s ¬∑ Canal de Suez ¬∑ Pan√≥ptico ¬∑ Bin√°rio",
  qs:[
    {n:2,s:"Literatura",t:"Para Mac√°rio, a poesia deveria ser:",opts:["(A) Elitista ‚Äî s√≥ para o rico","(B) Herm√©tica e obscura","(C) Despojada e simples","(D) Engajada politicamente","(E) Sentimental e rom√¢ntica"],ok:0,exp:"Mac√°rio defende que ela perten√ßa √† elite."},
    {n:4,s:"Literatura",t:"Efeito c√¥mico no di√°logo do burro decorre de:",opts:["(A) Ant√≠tese","(B) Eufemismo","(C) Hip√©rbole","(D) Ambiguidade","(E) Personifica√ß√£o"],ok:3,exp:"'Burro' = animal e insulto. Ambiguidade lexical gera mal-entendidos c√¥micos."},
    {n:11,s:"Filosofia",t:"Segundo Norbert Elias, a morte √© 'problema dos vivos' porque:",opts:["(A) Humanos antecipam a pr√≥pria morte","(B) Mortos deixam d√≠vidas","(C) A morte √© imprevis√≠vel","(D) Animais n√£o morrem","(E) Ci√™ncia n√£o estuda a morte"],ok:0,exp:"S√≥ humanos sabem que morrer√£o e tomam precau√ß√µes."},
    {n:61,s:"Biologia",t:"23 nomes populares de aves ‚Äî taxonomicamente pertencem a:",opts:["(A) 23 g√™neros","(B) 1 √∫nico g√™nero","(C) 23 esp√©cies em 1 g√™nero","(D) 1 fam√≠lia, sem inferir ordens","(E) 1 classe, sem inferir g√™neros"],ok:4,exp:"Todas s√£o aves = mesma classe (Aves)."},
    {n:85,s:"Matem√°tica",t:"Sobre T(n)=n(n+1)/2 e O(n)=n(n+1), qual CORRETA?",opts:["(A) 162 √© o 15¬∫ triangular","(B) 13¬∫ triangular √© primo","(C) 156 n√£o √© nem um nem outro","(D) 210 √© triangular E oblongo","(E) Diferen√ßa entre triangulares √© PG"],ok:3,exp:"T(20)=210 ‚úì e O(14)=210 ‚úì."},
    {n:88,s:"Matem√°tica",t:"Renato tem excesso de peso. P(press√£o elevada)?",opts:["(A) 12%","(B) 4%","(C) 50%","(D) 40%","(E) 10%"],ok:3,exp:"P(elevada|excesso) = P(elevada‚à©excesso)/P(excesso) = 10%/25% = 40%."},
  ]
}];

const MATS=["Todos","Biologia","Qu√≠mica","F√≠sica","Matem√°tica","Geografia","Hist√≥ria","Literatura","Filosofia","Reda√ß√£o","Ingl√™s"];
const TABS=["flashcards","quiz","essay","exams","stats"];

// ‚îÄ‚îÄ ESTADO (persistido no Firebase) ‚îÄ‚îÄ
let tab="flashcards",subj="Todos",diff=0;
let flipped={};
window.studied={};
window.qOk=0;window.qErr=0;
let qIdx=0,qAns=null,qAnswered=false,qDone=false;
let eTopic=null,eFB=null,eLoad=false,eScores=null;
let xAns={};
let savedEssays=[];
let expandedEssay=null;

// ‚îÄ‚îÄ SAVE TIMEOUT (debounce) ‚îÄ‚îÄ
let saveTimer=null;
function scheduleSave(){
  clearTimeout(saveTimer);
  saveTimer=setTimeout(()=>{
    if(window.fbSaveProgress) window.fbSaveProgress().then(()=>window._setStatus&&window._setStatus("üíæ Progresso salvo!"));
  },1500);
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function goTab(t){
  tab=t;
  document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
  document.querySelectorAll(".nb").forEach((b,i)=>b.classList.toggle("on",TABS[i]===t));
  document.getElementById("tab-"+t).classList.add("active");
  renderFilters();render();
  if(t==="essay") loadSavedEssays();
}
window.renderFilters=function(){
  const el=document.getElementById("farea");
  if(["essay","exams","stats"].includes(tab)){el.innerHTML="";return;}
  let h=`<div class="fbar"><span class="flabel">Mat√©ria:</span>`;
  MATS.forEach(m=>{const on=subj===m,c=COR[m]||"var(--v)";
    h+=`<button class="fc${on?" on":""}" style="${on?`background:${c}22;border-color:${c};color:${c}`:""}" onclick="setSubj('${m}')">${m}</button>`;});
  h+=`</div><div class="fbar" style="margin-bottom:20px"><span class="flabel">Dificuldade:</span><div class="dbar">`;
  [["0","TODOS"],["1","‚òÖ F√°cil"],["2","‚òÖ‚òÖ M√©dio"],["3","‚òÖ‚òÖ‚òÖ Dif√≠cil"]].forEach(([v,l])=>{
    h+=`<button class="dc${diff==v?" on":""}" data-d="${v}" onclick="setDiff(${v})">${l}</button>`;});
  h+=`</div></div>`;
  el.innerHTML=h;
}
function setSubj(s){subj=s;if(tab==="quiz")resetQuiz();renderFilters();render();}
function setDiff(d){diff=d;if(tab==="quiz")resetQuiz();renderFilters();render();}
window.render=function(){
  const fns={flashcards:renderCards,quiz:renderQuiz,essay:renderEssay,exams:renderExams,stats:renderStats};
  fns[tab]&&fns[tab]();updateHdr();
}

// ‚îÄ‚îÄ FLASHCARDS ‚îÄ‚îÄ
function getCards(){return CARDS.filter(c=>(subj==="Todos"||c.s===subj)&&(diff==0||c.d==diff));}
function renderCards(){
  const cards=getCards(),total=cards.length,done=cards.filter(c=>window.studied[c.id]).length;
  const p=document.getElementById("fcprog");p.style.display="flex";
  const pct=total?done/total*100:0;
  p.innerHTML=`<div class="ps-item"><div class="ps-label">Estudados</div><div class="ps-val" style="color:var(--ok)">${done}</div></div>
    <div class="ps-item"><div class="ps-label">Total</div><div class="ps-val">${total}</div></div>
    <div class="ps-bar-wrap"><div class="ps-label">Progresso ‚Äî ${Math.round(pct)}%</div>
      <div class="ps-bar"><div class="ps-fill" style="width:${pct}%;background:linear-gradient(90deg,var(--ok),var(--cy))"></div></div>
    </div>`;
  if(!cards.length){document.getElementById("cgrid").innerHTML='<div class="empty">Nenhum card para esses filtros.</div>';return;}
  document.getElementById("cgrid").innerHTML=cards.map(c=>{
    const f=flipped[c.id],col=COR[c.s]||"var(--v)";
    const dt=["","‚òÖ F√°cil","‚òÖ‚òÖ M√©dio","‚òÖ‚òÖ‚òÖ Dif√≠cil"][c.d],dc=["","d1","d2","d3"][c.d];
    return `<div class="card${f?" flip":""}" onclick="flipCard(${c.id})">
      <div class="card-top">
        <span class="stag" style="background:${col}22;color:${col}">${c.s}</span>
        <span class="dtag ${dc}">${dt}</span>
      </div>
      ${window.studied[c.id]?`<div class="card-check">‚úì</div>`:""}
      <p class="card-q">${c.q}</p>
      <div class="card-ans">${c.a}</div>
      <p class="card-hint">‚Ü© Toque para revelar</p>
    </div>`;
  }).join("");
}
function flipCard(id){
  flipped[id]=!flipped[id];
  window.studied[id]=true;
  renderCards();updateHdr();
  scheduleSave(); // üî• Salva no Firebase
}

// ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ
function getQuiz(){return QUIZ.filter(q=>(subj==="Todos"||q.s===subj)&&(diff==0||q.d==diff));}
function renderQuiz(){
  const qs=getQuiz(),w=document.getElementById("qwrap");
  if(!qs.length){w.innerHTML='<div class="empty">Nenhuma quest√£o para esses filtros.</div>';return;}
  if(qDone){
    const p=window.qOk/qs.length;
    w.innerHTML=`<div class="quiz-done">
      <span class="qd-emoji">${p>=.8?"üèÜ":p>=.6?"üí™":"üìñ"}</span>
      <div class="qd-h">${p>=.8?"Excelente dom√≠nio!":p>=.6?"Bom resultado!":"Continue estudando!"}</div>
      <div class="qd-score" style="color:${p>=.7?"var(--ok)":p>=.5?"var(--go)":"var(--no)"}">${window.qOk}/${qs.length}</div>
      <p class="qd-p">${p>=.8?"Voc√™ domina o conte√∫do da UNESP 2022.":p>=.6?"Revise os erros e repita.":"A persist√™ncia √© o caminho."}</p>
      <button class="btn" onclick="resetQuiz()">Tentar Novamente</button>
    </div>`;return;
  }
  const q=qs[qIdx],col=COR[q.s]||"var(--v)";
  const dt=["","‚òÖ F√°cil","‚òÖ‚òÖ M√©dio","‚òÖ‚òÖ‚òÖ Dif√≠cil"][q.d],dc=["","d1","d2","d3"][q.d];
  const opts=q.opts.map((o,i)=>{
    let c="opt";
    if(qAnswered){if(i===q.ok)c+=" ok";else if(i===qAns&&i!==q.ok)c+=" no";}
    return `<button class="${c}" onclick="answerQ(${i})" ${qAnswered?"disabled":""}>${o}</button>`;
  }).join("");
  const exp=qAnswered?`<div class="qexp"><strong>üí° Explica√ß√£o:</strong> ${q.exp}<br><small style="opacity:.55;margin-top:5px;display:block">Fonte: ${q.src}</small></div>
    <button class="btn btn-w" onclick="nextQ()">${qIdx+1>=qs.length?"Ver resultado ‚Üí":"Pr√≥xima quest√£o ‚Üí"}</button>`:"";
  w.innerHTML=`
    <div class="quiz-hdr">
      <div class="qprog"><div class="qprog-fill" style="width:${qIdx/qs.length*100}%"></div></div>
      <div class="qmeta"><span>Q${qIdx+1}/${qs.length}</span><span class="q-ok">‚úì${window.qOk}</span><span class="q-no">‚úó${window.qErr}</span></div>
    </div>
    <div class="qbox">
      <div class="qbox-top">
        <div style="display:flex;gap:7px;flex-wrap:wrap">
          <span class="stag" style="background:${col}22;color:${col}">${q.s}</span>
          <span class="dtag ${dc}">${dt}</span>
        </div>
        <span class="qsrc">${q.src}</span>
      </div>
      <p class="qq">${q.q}</p>
    </div>
    <div class="opts">${opts}</div>
    <div style="margin-top:13px">${exp}</div>`;
}
function answerQ(i){
  if(qAnswered)return;
  qAns=i;qAnswered=true;
  if(i===getQuiz()[qIdx].ok)window.qOk++;else window.qErr++;
  renderQuiz();updateHdr();
  scheduleSave(); // üî• Salva no Firebase
}
function nextQ(){const qs=getQuiz();if(qIdx+1>=qs.length)qDone=true;else{qIdx++;qAnswered=false;qAns=null;}renderQuiz();}
function resetQuiz(){qIdx=0;window.qOk=0;window.qErr=0;qAnswered=false;qDone=false;qAns=null;renderQuiz();updateHdr();}

// ‚îÄ‚îÄ REDA√á√ÉO ‚îÄ‚îÄ
async function loadSavedEssays(){
  if(!window.fbGetEssays)return;
  savedEssays=await window.fbGetEssays();
  if(tab==="essay")renderEssay();
}

function renderEssay(){
  const w=document.getElementById("ewrap");
  if(!eTopic){
    // Lista de temas + reda√ß√µes salvas
    const savedHTML=renderSavedEssaysHTML();
    w.innerHTML=`<div class="sec-hd">
        <div class="sec-title">Pr√°tica de Reda√ß√£o</div>
        <div class="sec-sub">Escolha um tema, escreva, corrija com IA e salve no Firebase automaticamente</div>
      </div>
      <div class="etopics">${ESSAY_TOPICS.map((t,i)=>`
        <div class="etcard" style="--c:${t.c}" onclick="selTopic(${i})">
          <span class="et-tipo" style="color:${t.c}">${t.tipo}</span>
          <div class="et-titulo">${t.t}</div>
          <div class="et-dica">${t.dica}</div>
        </div>`).join("")}</div>
      ${savedHTML}`;
    return;
  }
  // Editor
  const t=eTopic;
  let fbHTML="";
  if(eLoad){fbHTML=`<div class="efb"><div class="loading-dots"><span></span><span></span><span></span></div></div>`;}
  else if(eFB){
    const scs=eScores||{c1:0,c2:0,c3:0,c4:0,c5:0,total:0};
    fbHTML=`<div class="efb">
      <div class="efb-title">üìã Corre√ß√£o ‚Äî 5 Compet√™ncias ENEM
        <button class="btn-out" onclick="exportFBPDF()" style="margin-left:auto">üìÑ PDF da corre√ß√£o</button>
      </div>
      <div class="score-grid">
        <div class="score-card"><div class="score-n" style="color:${scoreColor(scs.c1,200)}">${scs.c1}/200</div><div class="score-lbl">‚ë† Norma Culta</div></div>
        <div class="score-card"><div class="score-n" style="color:${scoreColor(scs.c2,200)}">${scs.c2}/200</div><div class="score-lbl">‚ë° Tema</div></div>
        <div class="score-card"><div class="score-n" style="color:${scoreColor(scs.c3,200)}">${scs.c3}/200</div><div class="score-lbl">‚ë¢ Argumenta√ß√£o</div></div>
        <div class="score-card"><div class="score-n" style="color:${scoreColor(scs.c4,200)}">${scs.c4}/200</div><div class="score-lbl">‚ë£ Coes√£o</div></div>
        <div class="score-card"><div class="score-n" style="color:${scoreColor(scs.c5,200)}">${scs.c5}/200</div><div class="score-lbl">‚ë§ Proposta</div></div>
      </div>
      <div class="score-card" style="text-align:center;margin-bottom:18px;padding:14px">
        <div style="font-size:11px;color:var(--sub);margin-bottom:4px;font-family:'DM Mono',monospace">NOTA TOTAL</div>
        <div style="font-size:42px;font-weight:900;font-family:'DM Mono',monospace;color:${scoreColor(scs.total,1000)}">${scs.total}/1000</div>
      </div>
      <div class="efb-text">${eFB}</div>
    </div>`;
  }

  w.innerHTML=`
    <div class="print-header">
      <h2>Reda√ß√£o ‚Äî ${t.t}</h2>
      <p>Tema ${t.tipo} ¬∑ UNESP Study Hub ¬∑ ${new Date().toLocaleDateString('pt-BR')}</p>
    </div>
    <div class="essay-header">
      <button class="btn-out" onclick="voltarTemas()">‚Üê Temas</button>
      <h3 style="color:${t.c};font-family:'Instrument Serif',serif;font-size:18px;flex:1">${t.t}</h3>
      <span class="dtag" style="background:${t.c}22;color:${t.c}">${t.tipo}</span>
    </div>
    <div class="tipbox"><strong>üí° Dica:</strong> ${t.dica}</div>
    <div class="comp5">
      <strong style="color:var(--sub);font-size:11px;margin-right:4px">5 compet√™ncias:</strong>
      <span class="ctag">‚ë† Norma culta</span>
      <span class="ctag">‚ë° Tema</span>
      <span class="ctag">‚ë¢ Argumenta√ß√£o</span>
      <span class="ctag">‚ë£ Coes√£o</span>
      <span class="ctag">‚ë§ Proposta</span>
    </div>
    <textarea id="eta" placeholder="Escreva sua reda√ß√£o aqui...&#10;&#10;Dica: introdu√ß√£o + 2 argumentos + conclus√£o com proposta de interven√ß√£o completa." oninput="updW()">${window._etxt||""}</textarea>
    <div class="essay-toolbar">
      <span class="wc" id="wc">0 palavras ¬∑ 0 linhas</span>
      <div class="essay-actions">
        <button class="btn-copy" onclick="copyText()">üìã Copiar</button>
        <button class="btn-pdf" onclick="savePDF()">üìÑ PDF</button>
        <button class="btn-save" id="saveBtn" onclick="salvarRedacao()" disabled>‚òÅÔ∏è Salvar no Firebase</button>
        <button class="btn" id="corrBtn" onclick="corrigir()" disabled>${eLoad?"‚è≥ Corrigindo...":"üéì Corrigir com IA"}</button>
      </div>
    </div>
    ${fbHTML}`;
  updW();
}

function renderSavedEssaysHTML(){
  if(!savedEssays.length) return `<div class="saved-essays"><div class="saved-title">üìÅ Reda√ß√µes Salvas <span>‚Äî nenhuma ainda</span></div></div>`;
  const items=savedEssays.map(e=>{
    const dt=e.savedAt?.seconds?new Date(e.savedAt.seconds*1000).toLocaleDateString('pt-BR','dd/MM/yyyy'):"";
    const detailHTML=expandedEssay===e.id?`
      <div class="essay-detail">
        <div class="essay-detail-text">${e.texto||""}</div>
        ${e.feedback?`<div style="font-size:12px;color:var(--sub);border-top:1px solid var(--line);padding-top:12px;white-space:pre-wrap">${e.feedback}</div>`:""}
      </div>`:"";
    return `<div>
      <div class="essay-item">
        <div class="essay-item-info">
          <div class="essay-item-title">${e.titulo||e.tema||"Sem t√≠tulo"}</div>
          <div class="essay-item-meta">${e.tipo||""} ¬∑ ${dt} ¬∑ ${(e.texto||"").split(/\s+/).filter(Boolean).length} palavras</div>
        </div>
        ${e.total?`<div class="essay-item-score" style="color:${scoreColor(e.total,1000)}">${e.total}<span style="font-size:12px;color:var(--sub)">/1000</span></div>`:""}
        <div class="essay-item-actions">
          <button class="btn-sm" onclick="toggleEssayDetail('${e.id}')">${expandedEssay===e.id?"‚ñ≤ Fechar":"‚ñº Ver"}</button>
          <button class="btn-sm" onclick="carregarRedacao(${JSON.stringify(e).replace(/"/g,'&quot;')})">‚úèÔ∏è Editar</button>
          <button class="btn-sm danger" onclick="deletarRedacao('${e.id}')">üóëÔ∏è Deletar</button>
        </div>
      </div>
      ${detailHTML}
    </div>`;
  }).join("");
  return `<div class="saved-essays">
    <div class="saved-title">üìÅ Reda√ß√µes Salvas <span>‚Äî ${savedEssays.length} no Firebase</span></div>
    <div class="essay-list">${items}</div>
  </div>`;
}

function toggleEssayDetail(id){
  expandedEssay=expandedEssay===id?null:id;
  renderEssay();
}

function carregarRedacao(e){
  const topic=ESSAY_TOPICS.find(t=>t.t===e.titulo||t.t===e.tema)||{t:e.titulo||e.tema,tipo:e.tipo||"",c:"#7c5cfc",dica:""};
  eTopic=topic;
  window._etxt=e.texto||"";
  eScores={c1:e.c1||0,c2:e.c2||0,c3:e.c3||0,c4:e.c4||0,c5:e.c5||0,total:e.total||0};
  eFB=e.feedback||null;
  renderEssay();
}

async function deletarRedacao(id){
  if(!confirm("Deletar esta reda√ß√£o?"))return;
  if(window.fbDeleteEssay){
    await window.fbDeleteEssay(id);
    showToast("üóëÔ∏è Reda√ß√£o deletada");
    await loadSavedEssays();
  }
}

function scoreColor(v,max){const p=v/max;return p>=.8?"var(--ok)":p>=.5?"var(--go)":"var(--no)";}

function updW(){
  const ta=document.getElementById("eta");if(!ta)return;
  const txt=ta.value;window._etxt=txt;
  const ws=txt.split(/\s+/).filter(Boolean).length,ls=txt.split("\n").filter(x=>x.trim()).length;
  const wc=document.getElementById("wc");if(wc)wc.textContent=`${ws} palavras ¬∑ ${ls} linhas`;
  const btn=document.getElementById("corrBtn");
  const saveBtn=document.getElementById("saveBtn");
  const hasText=txt.trim().length>=80&&!eLoad;
  if(btn){btn.disabled=!hasText;btn.textContent=eLoad?"‚è≥ Corrigindo...":"üéì Corrigir com IA";}
  if(saveBtn){saveBtn.disabled=txt.trim().length<20;}
}

function selTopic(i){eTopic=ESSAY_TOPICS[i];eFB=null;eScores=null;window._etxt="";renderEssay();}
function voltarTemas(){eTopic=null;eFB=null;eScores=null;window._etxt="";renderEssay();loadSavedEssays();}

async function salvarRedacao(){
  const ta=document.getElementById("eta");
  if(!ta||ta.value.trim().length<20)return;
  const saveBtn=document.getElementById("saveBtn");
  if(saveBtn){saveBtn.disabled=true;saveBtn.textContent="‚è≥ Salvando...";}
  const id=await window.fbSaveEssay(
    eTopic?.t||"Sem t√≠tulo",
    eTopic?.t||"",
    eTopic?.tipo||"",
    ta.value,
    eScores,
    eFB||""
  );
  if(id){
    showToast("‚òÅÔ∏è Reda√ß√£o salva no Firebase!");
    await loadSavedEssays();
  } else {
    showToast("‚ö†Ô∏è Erro ao salvar. Tente novamente.");
  }
  if(saveBtn){saveBtn.disabled=false;saveBtn.textContent="‚òÅÔ∏è Salvar no Firebase";}
}

function copyText(){
  const ta=document.getElementById("eta");if(!ta||!ta.value.trim())return;
  navigator.clipboard.writeText(ta.value).then(()=>showToast("‚úì Texto copiado!")).catch(()=>{
    ta.select();document.execCommand("copy");showToast("‚úì Texto copiado!");
  });
}
function showToast(msg){
  const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2800);
}

function savePDF(){
  const ta=document.getElementById("eta");
  if(!ta||!ta.value.trim()){showToast("‚ö†Ô∏è Escreva a reda√ß√£o primeiro!");return;}
  const titulo=eTopic?.t||"Reda√ß√£o",conteudo=ta.value,data=new Date().toLocaleDateString('pt-BR');
  const win=window.open("","_blank","width=800,height=600");
  win.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Reda√ß√£o ‚Äî ${titulo}</title>
    <style>body{font-family:Georgia,serif;max-width:700px;margin:40px auto;padding:40px;color:#111;line-height:1.9;font-size:14pt}
    h1{font-size:18pt;border-bottom:2px solid #111;padding-bottom:10px;margin-bottom:6px}.meta{color:#666;font-size:10pt;margin-bottom:30px}
    .texto{white-space:pre-wrap;text-align:justify;text-indent:2em}@media print{body{margin:20mm;padding:0}}</style></head><body>
    <h1>${titulo}</h1><div class="meta">Tema ${eTopic?.tipo||""} ¬∑ UNESP Study Hub ¬∑ ${data}</div>
    <div class="texto">${conteudo.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>
    <script>window.onload=function(){window.print();}<\/script></body></html>`);
  win.document.close();
}

function exportFBPDF(){
  if(!eFB)return;
  const titulo=eTopic?.t||"Reda√ß√£o",scs=eScores||{};
  const win=window.open("","_blank","width=800,height=700");
  win.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Corre√ß√£o ‚Äî ${titulo}</title>
    <style>body{font-family:Arial,sans-serif;max-width:700px;margin:40px auto;padding:40px;color:#111;line-height:1.75;font-size:12pt}
    h1{font-size:18pt;border-bottom:2px solid #333;padding-bottom:8px}.meta{color:#666;font-size:10pt;margin-bottom:24px}
    .scores{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:20px 0}
    .sc{border:1px solid #ccc;border-radius:6px;padding:10px;text-align:center}.sc-n{font-size:20pt;font-weight:900}.sc-l{font-size:8pt;color:#666}
    .total{font-size:28pt;font-weight:900;text-align:center;border:2px solid #333;border-radius:8px;padding:14px;margin:14px 0}
    .texto{white-space:pre-wrap}@media print{body{margin:20mm;padding:0}}</style></head><body>
    <h1>Corre√ß√£o de Reda√ß√£o</h1>
    <div class="meta">Tema: ${titulo} ¬∑ ${eTopic?.tipo||""} ¬∑ ${new Date().toLocaleDateString('pt-BR')}</div>
    <div class="scores">
      <div class="sc"><div class="sc-n">${scs.c1||0}/200</div><div class="sc-l">‚ë† Norma Culta</div></div>
      <div class="sc"><div class="sc-n">${scs.c2||0}/200</div><div class="sc-l">‚ë° Tema</div></div>
      <div class="sc"><div class="sc-n">${scs.c3||0}/200</div><div class="sc-l">‚ë¢ Argumenta√ß√£o</div></div>
      <div class="sc"><div class="sc-n">${scs.c4||0}/200</div><div class="sc-l">‚ë£ Coes√£o</div></div>
      <div class="sc"><div class="sc-n">${scs.c5||0}/200</div><div class="sc-l">‚ë§ Proposta</div></div>
    </div>
    <div class="total">NOTA TOTAL: ${scs.total||0}/1000</div>
    <div class="texto">${eFB.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>
    <script>window.onload=function(){window.print();}<\/script></body></html>`);
  win.document.close();
}

async function corrigir(){
  const ta=document.getElementById("eta");
  if(!ta||ta.value.trim().length<80)return;
  eLoad=true;const txt=ta.value;renderEssay();
  try{
    const res=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1400,
        system:`Voc√™ √© professor especialista em reda√ß√£o ENEM. Avalie o texto pelas 5 compet√™ncias (0-200 cada, m√°x 1000). 
IMPORTANTE: Na primeira linha retorne SOMENTE os scores em JSON assim: {"c1":160,"c2":180,"c3":160,"c4":140,"c5":160,"total":800}
Depois, separe com uma linha em branco e escreva a avalia√ß√£o completa em portugu√™s com se√ß√µes C1 a C5, Pontos Fortes e A Melhorar. Seja construtivo e espec√≠fico.`,
        messages:[{role:"user",content:`Tema: "${eTopic.t}" (${eTopic.tipo})\n\nReda√ß√£o:\n${txt}`}]})});
    const data=await res.json();
    const raw=(data.content&&data.content[0]?.text)||"";
    const linhas=raw.split("\n");
    let scoresJSON=null;
    for(let i=0;i<Math.min(4,linhas.length);i++){
      const l=linhas[i].trim();if(l.startsWith("{")){try{scoresJSON=JSON.parse(l);break;}catch(e){}}
    }
    eScores=scoresJSON||{c1:0,c2:0,c3:0,c4:0,c5:0,total:0};
    eFB=linhas.slice(scoresJSON?1:0).join("\n").trim();
    window._etxt=txt;
    
    // üî• Salva automaticamente depois de corrigir
    if(window.fbSaveEssay){
      await window.fbSaveEssay(eTopic?.t||"Sem t√≠tulo",eTopic?.t||"",eTopic?.tipo||"",txt,eScores,eFB);
      showToast("‚òÅÔ∏è Reda√ß√£o corrigida e salva automaticamente!");
      loadSavedEssays();
    }
  }catch(e){eFB="Erro de conex√£o com a IA. Verifique sua internet e tente novamente.";}
  eLoad=false;renderEssay();
}

// ‚îÄ‚îÄ PROVAS ‚îÄ‚îÄ
function renderExams(){
  const w=document.getElementById("xwrap");
  const pdfURL="provafase1_exatashumanas.pdf";
  let h=`<div class="pdf-hero">
    <div class="pdf-h3">üìÑ UNESP 2022 ‚Äî Prova Completa</div>
    <div class="pdf-p">90 quest√µes ¬∑ Biologia, Qu√≠mica, F√≠sica, Matem√°tica, Geografia, Hist√≥ria, Literatura, Ingl√™s, Filosofia</div>
    <div class="pdf-acts">
      <a href="${pdfURL}" download class="pdf-gold">‚¨áÔ∏è Baixar PDF</a>
      <button class="pdf-sec" onclick="togglePDF()"><span id="pdfLbl">üëÅÔ∏è Ver na tela</span></button>
      <a href="${pdfURL}" target="_blank" class="pdf-sec">üîó Nova aba</a>
    </div>
    <div class="pdf-viewer" id="pdfV"><iframe src="${pdfURL}" title="UNESP 2022"></iframe></div>
  </div>
  <p style="color:var(--sub);font-size:12px;margin-bottom:22px;background:var(--ink3);border:1px solid var(--line);padding:12px 16px;border-radius:10px">
    ‚ö†Ô∏è Para o PDF funcionar, coloque <code style="color:var(--v2)">provafase1_exatashumanas.pdf</code> no mesmo diret√≥rio que o <code style="color:var(--v2)">index.html</code>.
  </p>
  <div class="egrid">`;
  EXAMS.forEach(ex=>{
    const qs=ex.qs.map(q=>{
      const key=ex.id+"_"+q.n,ans=xAns[key],col=COR[q.s]||"var(--v)";
      const opts=q.opts.map((o,i)=>{let c="qopt";
        if(ans!==undefined){if(i===q.ok)c+=" ok";else if(i===ans&&i!==q.ok)c+=" no";}
        return `<button class="${c}" onclick="ansExam('${key}',${i},${q.ok})" ${ans!==undefined?"disabled":""}>${o}</button>`;
      }).join("");
      return `<div class="qitem">
        <div class="qitem-top"><span class="qnum">Q${q.n}</span><span class="stag" style="background:${col}22;color:${col};font-size:10px">${q.s}</span></div>
        <p>${q.t}</p><div class="qopts">${opts}</div>
        <div class="qexp2${ans!==undefined?" show":""}" id="exp_${key}">üí° ${q.exp}</div>
      </div>`;}).join("");
    const tags=ex.mats.map(m=>`<span class="stag" style="background:${COR[m]||"#fff"}22;color:${COR[m]||"#fff"};font-size:10px">${m}</span>`).join("");
    h+=`<div class="exam-card">
      <div class="exam-head">
        <div><span class="ebadge">UNESP</span><h3 style="color:var(--txt);font-size:17px;margin-top:9px">${ex.nome}</h3></div>
        <div class="eyear" style="color:${ex.cor}">${ex.ano}</div>
      </div>
      <div class="exam-body">
        <div class="estats">
          <div class="estat"><div class="estat-n" style="color:${ex.cor}">${ex.total}</div><div class="estat-l">quest√µes</div></div>
          <div class="estat"><div class="estat-n" style="color:${ex.cor}">${ex.mats.length}</div><div class="estat-l">mat√©rias</div></div>
          <div class="estat"><div class="estat-n" style="color:${ex.cor}">${ex.qs.length}</div><div class="estat-l">aqui</div></div>
        </div>
        <p class="exam-hl">‚ú¶ ${ex.hl}</p>
        <div class="etags">${tags}</div>
        <button class="etog" onclick="toggleExam('${ex.id}')">üìñ Ver quest√µes selecionadas</button>
        <div class="eqs" id="qs_${ex.id}"><div style="margin-top:10px">${qs}</div></div>
      </div>
    </div>`;
  });
  w.innerHTML=h+`</div>`;
}
function togglePDF(){const v=document.getElementById("pdfV"),l=document.getElementById("pdfLbl"),s=v.style.display!=="block";v.style.display=s?"block":"none";l.textContent=s?"üîº Ocultar PDF":"üëÅÔ∏è Ver na tela";}
function toggleExam(id){document.getElementById("qs_"+id).classList.toggle("open");}
function ansExam(key,c,ok){
  if(xAns[key]!==undefined)return;
  xAns[key]=c;renderExams();
  setTimeout(()=>{const e=document.getElementById("exp_"+key);if(e)e.scrollIntoView({behavior:"smooth",block:"nearest"});
    const id=key.split("_")[0],el=document.getElementById("qs_"+id);if(el&&!el.classList.contains("open"))el.classList.add("open");},80);
}

// ‚îÄ‚îÄ PROGRESSO ‚îÄ‚îÄ
function renderStats(){
  const w=document.getElementById("swrap");
  const tc=CARDS.length,dc=Object.keys(window.studied).length;
  const d1=CARDS.filter(c=>c.d===1),d2=CARDS.filter(c=>c.d===2),d3=CARDS.filter(c=>c.d===3);
  const d1d=d1.filter(c=>window.studied[c.id]).length,d2d=d2.filter(c=>window.studied[c.id]).length,d3d=d3.filter(c=>window.studied[c.id]).length;
  const ms={};CARDS.forEach(c=>{if(!ms[c.s])ms[c.s]={t:0,d:0};ms[c.s].t++;if(window.studied[c.id])ms[c.s].d++;});
  const mrows=Object.entries(ms).map(([s,v])=>{
    const col=COR[s]||"var(--v)",p=v.t?Math.round(v.d/v.t*100):0;
    return `<div class="mat-row">
      <span class="stag" style="background:${col}22;color:${col};min-width:88px;text-align:center">${s}</span>
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--sub);margin-bottom:4px">
          <span>${v.d}/${v.t}</span><span style="color:${col};font-weight:700;font-family:'DM Mono',monospace">${p}%</span>
        </div>
        <div class="pbar"><div class="pfill" style="width:${p}%;background:${col}"></div></div>
      </div>
    </div>`;}).join("");
  const tqz=QUIZ.length,pqz=tqz?Math.round(window.qOk/tqz*100):0;
  const fbSaved=savedEssays.length;
  w.innerHTML=`<div class="sec-hd"><div class="sec-title">Meu Progresso</div><div class="sec-sub">Dados sincronizados com o Firebase ‚òÅÔ∏è</div></div>
    <div class="stat-nums">
      <div class="sn"><div class="sn-num" style="color:var(--v2)">${dc}</div><div class="sn-lbl">Cards estudados</div><div class="sn-sub">de ${tc} total</div></div>
      <div class="sn"><div class="sn-num" style="color:var(--ok)">${d1d}/${d1.length}</div><div class="sn-lbl">‚òÖ F√°ceis</div></div>
      <div class="sn"><div class="sn-num" style="color:var(--go)">${d2d}/${d2.length}</div><div class="sn-lbl">‚òÖ‚òÖ M√©dios</div></div>
      <div class="sn"><div class="sn-num" style="color:var(--no)">${d3d}/${d3.length}</div><div class="sn-lbl">‚òÖ‚òÖ‚òÖ Dif√≠ceis</div></div>
      <div class="sn"><div class="sn-num" style="color:var(--cy)">${window.qOk}/${tqz}</div><div class="sn-lbl">Quiz acertos</div></div>
      <div class="sn"><div class="sn-num" style="color:var(--pi)">${fbSaved}</div><div class="sn-lbl">Reda√ß√µes salvas</div><div class="sn-sub">no Firebase</div></div>
    </div>
    <div class="sec-hd" style="margin-top:10px"><div class="sec-title" style="font-size:16px">Por Mat√©ria</div></div>
    <div class="mat-list">${mrows}</div>`;
}

function updateHdr(){
  const cs=getCards(),d=cs.filter(c=>window.studied[c.id]).length;
  document.getElementById("stCards").textContent=`${d}/${cs.length}`;
  const qs=getQuiz(),p=qs.length?Math.round(window.qOk/qs.length*100):0;
  document.getElementById("stQuiz").textContent=p+"%";
  document.getElementById("stDiff").textContent=["Todos","F√°cil","M√©dio","Dif√≠cil"][diff];
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
renderFilters();render();
</script>
</body>
</html>
